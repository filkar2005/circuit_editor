Данная версия уже более-менее оптимизирована. (По сравнению с предыдущей версией - в 1.35 раз)

Нужен контроль за расчётом ЭДС, ошибка, должно быть, именно там.
И изменить везде напраления расчёта на обычные.

!!! решение происходит некорректно !!!
Конденсатор разряжается, вместо того, чтобы заряжаться.

!!! Нужно написать решение уравнений заново !!!
Я не могу найти ошибку. Может пропадёт, если всё расписать на бумажке и сделать в программе...